<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Tic-Tac-Toe</title>
    <style>
        .board { display: grid; grid-template-columns: repeat(3, 100px); gap: 10px; margin: 20px auto; }
        .cell { width: 100px; height: 100px; background-color: #f0f0f0; display: flex; align-items: center; justify-content: center; font-size: 36px; cursor: pointer; }
    </style>
</head>
<body>
    <h2>Tic-Tac-Toe</h2>
    <div>
        <button onclick="createGame()">Create New Game</button>
        Game ID: <input type="text" id="gameId">
        <button onclick="joinGame('X')">Join as X</button>
        <button onclick="joinGame('O')">Join as O</button>
    </div>
    <div class="board">
        <!-- Cells will be generated by JavaScript -->
    </div>

    <script>
        let currentGameId = '';
        let playerRole = '';

        document.addEventListener("DOMContentLoaded", function() {
            generateBoard();
        });

        function generateBoard() {
            const board = document.querySelector('.board');
            board.innerHTML = '';  // Clear the board
            for (let i = 0; i < 9; i++) {
                const cell = document.createElement('div');
                cell.classList.add('cell');
                cell.addEventListener('click', () => makeMove(i));
                board.appendChild(cell);
            }
        }

        function createGame() {
            fetch('/game/new', { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    currentGameId = data.game_id;
                    document.getElementById('gameId').value = currentGameId;
                    alert('Game created. Share the Game ID with your friend.');
                });
        }

        function joinGame(role) {
            const gameId = document.getElementById('gameId').value;
            if (!gameId) {
                alert('Please enter a Game ID.');
                return;
            }
            currentGameId = gameId;
            playerRole = role;
            fetch(`/game/${gameId}/join`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({role})
            })
            .then(response => response.json())
            .then(data => {
                if (data.role) {
                    alert(`Joined as ${data.role}`);
                }
            });
        }

        function makeMove(position) {
            if (!currentGameId || !playerRole) {
                alert('Please create or join a game first.');
                return;
            }
            fetch(`/game/${currentGameId}/move`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({position, role: playerRole})
            })
            .then(response => response.json())
            .then(data => {
                updateBoard(data);
            });
        }

        function updateBoard(game) {
            const cells = document.querySelectorAll('.cell');
            game.board.forEach((mark, index) => {
                cells[index].innerText = mark;
            });
            if (game.winner || game.draw) {
                let message = game.draw ? "It's a draw!" : `Player ${game.winner} wins!`;
                alert(message);
                generateBoard(); // Reset the board for a new game
            }
        }
    </script>
</body>
</html>
