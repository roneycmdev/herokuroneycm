<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Tic-Tac-Toe Game</title>
    <style>
        #board {
            display: grid;
            grid-template-columns: repeat(3, 100px);
            grid-gap: 5px;
            margin: 20px auto;
            max-width: 300px;
        }
        .cell {
            width: 100px;
            height: 100px;
            background-color: #f0f0f0;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h2>Tic-Tac-Toe Game</h2>
    <button id="newGameBtn">New Game</button>
    <input type="text" id="gameId" placeholder="Enter Game ID">
    <button id="joinGameBtn">Join Game</button>
    <div id="board"></div>

    <script>
        const boardElement = document.getElementById('board');
        let gameId;

        function createBoard() {
            boardElement.innerHTML = '';
            for (let i = 0; i < 9; i++) {
                const cell = document.createElement('div');
                cell.classList.add('cell');
                cell.addEventListener('click', () => makeMove(i));
                boardElement.appendChild(cell);
            }
        }

        document.getElementById('newGameBtn').addEventListener('click', function() {
            fetch('/game/new', { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    gameId = data.game_id;
                    document.getElementById('gameId').value = gameId;
                    alert(`New game created. Game ID: ${gameId}`);
                    createBoard();
                });
        });

        document.getElementById('joinGameBtn').addEventListener('click', function() {
            gameId = document.getElementById('gameId').value;
            if (!gameId) {
                alert('Please enter a game ID.');
                return;
            }
            alert(`Joining game: ${gameId}`);
            createBoard();
            fetchGameStatus();
        });

        function makeMove(position) {
            if (!gameId) {
                alert('Please create or join a game first.');
                return;
            }
            fetch(`/game/${gameId}/move`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ position, player: 'X' }) // This assumes player X. Modify as needed.
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    alert(data.error);
                } else {
                    updateBoard(data);
                }
            });
        }

        function fetchGameStatus() {
            fetch(`/game/${gameId}/status`)
                .then(response => response.json())
                .then(data => updateBoard(data));
        }

        function updateBoard(gameState) {
            gameState.board.forEach((cell, index) => {
                boardElement.children[index].textContent = cell;
            });
            if (gameState.winner) {
                alert(`Player ${gameState.winner} wins!`);
            } else if (gameState.draw) {
                alert('The game is a draw!');
            }
        }

        createBoard(); // Initialize an empty board
    </script>
</body>
</html>
